<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Backend Testing Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f7f9fc; color: #333; }
    h1 { text-align: center; color: #2c3e50; }
    section { background: #fff; padding: 15px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    input, textarea, select { width: 95%; padding: 8px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; }
    button { margin: 5px 0; padding: 8px 16px; border: none; border-radius: 5px; background: #3498db; color: #fff; cursor: pointer; }
    button:hover { background: #2980b9; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 5px; overflow-x: auto; }
    .token-box { background: #eafaf1; padding: 10px; border-left: 4px solid #27ae60; font-family: monospace; word-break: break-all; }
    .question-box { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
  </style>
</head>
<body>
<h1>Backend Testing Dashboard</h1>

<!-- Register -->
<section>
  <h2>Register User</h2>
  <input id="regName" placeholder="Name"><br>
  <input id="regEmail" placeholder="Email"><br>
  <input id="regPassword" type="password" placeholder="Password"><br>
  <select id="regRole"><option value="student">Student</option><option value="teacher">Teacher</option></select><br>
  <button onclick="register()">Register</button>
  <pre id="registerResult"></pre>
</section>

<!-- Login -->
<section>
  <h2>Login</h2>
  <input id="loginEmail" placeholder="Email"><br>
  <input id="loginPassword" type="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
  <div class="token-box" id="tokenBox">No token yet</div>
  <pre id="loginResult"></pre>
</section>

<!-- Schools -->
<section>
  <h2>Schools</h2>
  <input id="schoolName" placeholder="School Name"><br>
  <input id="schoolAddress" placeholder="Address"><br>
  <input id="schoolCode" placeholder="School Code"><br>
  <button onclick="createSchool()">Create School</button>
  <button onclick="getSchools()">Get Schools</button>
  <pre id="schoolResult"></pre>
</section>

<!-- Courses -->
<section>
  <h2>Courses</h2>
  <input id="courseId" placeholder="Course ID"><br>
  <input id="courseTitle" placeholder="Course Title"><br>
  <input id="courseDesc" placeholder="Description"><br>
  <select id="courseGrade">
    <option value="6">Grade 6</option><option value="7">Grade 7</option>
    <option value="8">Grade 8</option><option value="9">Grade 9</option>
    <option value="10">Grade 10</option><option value="11">Grade 11</option>
    <option value="12">Grade 12</option>
  </select><br>
  <button onclick="createCourse()">Create Course</button>
  <button onclick="getCourses()">Get Courses</button>
  <pre id="courseResult"></pre>
</section>

<!-- Quizzes (Teacher) -->
<section>
  <h2>Create Quiz (Teacher)</h2>
  <input id="quizCourseId" placeholder="Course ID"><br>
  <input id="quizTitle" placeholder="Quiz Title"><br>
  <div id="questionsContainer"></div>
  <button onclick="addQuestion()">+ Add Question</button><br>
  <button onclick="submitQuiz()">Submit Quiz</button>
  <pre id="quizResult"></pre>
</section>

<!-- Attempt Quiz (Student) -->
<section>
  <h2>Attempt Quiz (Student)</h2>
  <input id="attemptQuizId" placeholder="Quiz ID"><br>
  <button onclick="loadQuiz()">Load Quiz</button>
  <div id="quizAttemptContainer"></div>
  <button onclick="submitAttempt()">Submit Attempt</button>
  <pre id="attemptResult"></pre>
</section>

<script>
let token = "", questions = [], currentQuiz = [], studentAnswers = [];

// --- API Request ---
async function apiRequest(url, method="GET", body=null, auth=false){
  if(auth && !token){ alert("Login first!"); return {error:"No token"}; }
  try{
    const opt={method, headers:{"Content-Type":"application/json"}};
    if(body) opt.body=JSON.stringify(body);
    if(auth) opt.headers.Authorization=`Bearer ${token}`;
    const res=await fetch(url,opt);
    const data=await res.json();
    if(!res.ok) throw new Error(data.message || "Request failed");
    return data;
  }catch(err){ return {error:err.message}; }
}

// --- Register ---
async function register(){
  const data=await apiRequest("/api/users/register","POST",{
    name:document.getElementById("regName").value,
    email:document.getElementById("regEmail").value,
    password:document.getElementById("regPassword").value,
    role:document.getElementById("regRole").value
  });
  document.getElementById("registerResult").textContent=JSON.stringify(data,null,2);
}

// --- Login ---
async function login(){
  const data=await apiRequest("/api/users/login","POST",{
    email:document.getElementById("loginEmail").value,
    password:document.getElementById("loginPassword").value
  });
  document.getElementById("loginResult").textContent=JSON.stringify(data,null,2);
  if(data.token){token=data.token;document.getElementById("tokenBox").textContent="Token: "+token;}
}

// --- Schools ---
async function createSchool(){
  const data=await apiRequest("/api/schools","POST",{
    name:document.getElementById("schoolName").value,
    address:document.getElementById("schoolAddress").value,
    code:document.getElementById("schoolCode").value
  },true);
  document.getElementById("schoolResult").textContent=JSON.stringify(data,null,2);
}
async function getSchools(){
  const data=await apiRequest("/api/schools","GET",null,true);
  document.getElementById("schoolResult").textContent=JSON.stringify(data,null,2);
}

// --- Courses ---
async function createCourse(){
  const data=await apiRequest("/api/courses","POST",{
    course_id:document.getElementById("courseId").value,
    title:document.getElementById("courseTitle").value,
    description:document.getElementById("courseDesc").value,
    grade:parseInt(document.getElementById("courseGrade").value)
  },true);
  document.getElementById("courseResult").textContent=JSON.stringify(data,null,2);
}
async function getCourses(){
  const data = await apiRequest("/api/courses","GET",null,true);
  document.getElementById("courseResult").textContent=JSON.stringify(data,null,2);
}

// --- Quiz Creation ---
function addQuestion(){
  const idx=questions.length;
  questions.push({questionText:"",options:["",""],correctAnswer:0,marks:1});
  const div=document.createElement("div");
  div.id="question-"+idx; div.className="question-box";
  div.innerHTML=`
    Q${idx+1}: <input placeholder="Question text" oninput="questions[${idx}].questionText=this.value"><br>
    <div id="options-${idx}">
      <input placeholder="Option 1" oninput="questions[${idx}].options[0]=this.value"><br>
      <input placeholder="Option 2" oninput="questions[${idx}].options[1]=this.value"><br>
    </div>
    <button onclick="addOption(${idx})">+ Add Option</button><br>
    Correct Answer:
    <select onchange="questions[${idx}].correctAnswer=this.value">
      <option value="0">Option 1</option>
      <option value="1">Option 2</option>
    </select><br>
    Marks: <input type="number" value="1" min="1" oninput="questions[${idx}].marks=this.value"><br>
  `;
  document.getElementById("questionsContainer").appendChild(div);
}
function addOption(idx){
  const q=questions[idx];
  q.options.push("");
  const optIdx=q.options.length-1;
  const input=document.createElement("input");
  input.placeholder=`Option ${optIdx+1}`;
  input.oninput=(e)=>{q.options[optIdx]=e.target.value;};
  document.getElementById("options-"+idx).appendChild(document.createElement("br"));
  document.getElementById("options-"+idx).appendChild(input);
  const select=document.querySelector(`#question-${idx} select`);
  const opt=document.createElement("option");
  opt.value=optIdx; opt.text=`Option ${optIdx+1}`; select.add(opt);
}
async function submitQuiz(){
  const data=await apiRequest("/api/quizzes","POST",{
    courseId:document.getElementById("quizCourseId").value,
    title:document.getElementById("quizTitle").value,
    questions
  },true);
  document.getElementById("quizResult").textContent=JSON.stringify(data,null,2);
}

// --- Quiz Attempt ---
async function loadQuiz(){
  const quizId=document.getElementById("attemptQuizId").value;
  const data=await apiRequest(`/api/quizzes/${quizId}`,"GET",null,true);
  if(data.questions){
    currentQuiz=data.questions; studentAnswers=new Array(currentQuiz.length).fill(null);
    renderQuiz();
  }
}
function renderQuiz(){
  const container=document.getElementById("quizAttemptContainer"); container.innerHTML="";
  currentQuiz.forEach((q,i)=>{
    const div=document.createElement("div"); div.className="question-box";
    div.innerHTML=`<b>Q${i+1}: ${q.questionText}</b><br>`;
    q.options.forEach((opt,idx)=>{
      div.innerHTML+=`<input type="radio" name="q${i}" value="${idx}" onclick="studentAnswers[${i}]=${idx}"> ${opt}<br>`;
    });
    container.appendChild(div);
  });
}
async function submitAttempt(){
  const quizId=document.getElementById("attemptQuizId").value;
  const answers=studentAnswers.map((sel,idx)=>({questionIndex:idx,selectedOption:sel}));
  const data=await apiRequest(`/api/quizzes/${quizId}/attempt`,"POST",{answers},true);
  document.getElementById("attemptResult").textContent=JSON.stringify(data,null,2);
}
</script>
</body>
</html>
